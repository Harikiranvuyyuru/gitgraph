ELECT * FROM watch

from cassandra.cluster import Cluster
from flask import Flask
import json

cluster = Cluster(['52.8.127.252'])
session = cluster.connect('watch_events')

app = Flask(__name__)

@app.route("/cass/<repo>")
def cass_api(repo):
  cql = "SELECT * FROM watch WHERE reponame = %s"
  #bound_stmt = prepared_stmt.bind(str(repo))
  stmt = session.execute(cql,parameters=[repo] )
  return json.dumps(stmt)

@app.route("/cassall")
def cass_all():
  print "ronak"
  cql = "SELECT * FROM watch"
  print "\n\nronak\n\n"
  #bound_stmt = prepared_stmt.bind(str(repo))
  stmt = session.execute(cql)
  responselist = json.dumps(stmt)
  jsonresponse = [{"reponame":x[0], "watchcount":x[1]} for x in responselist]
  return render_template("index.html", repos = jsonresponse)


@app.route("/")
@app.route("/index")
def hello():
  return "Hello World!"

@app.route("/holla")
def holla():
  return "Holla World!"

@app.route("/api/<month>/")
def api(month):
  return "This is data for " + month

@app.route("/api/<month>/<days>/")
def api_stats(month, days):
  data = int(days) + 10
  if data == 31:
    strng = "There are " + str(data) + " days in " + month
  else:
    strng = "Check a calendar"
  return strng

if __name__ == "__main__":
  app.run(host='0.0.0.0', debug=True)

